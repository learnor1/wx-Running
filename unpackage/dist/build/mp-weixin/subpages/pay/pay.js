"use strict";const e=require("../../common/vendor.js"),o=require("../../stores/counter.js"),a=require("../../request/index.js");if(!Array){(e.resolveComponent("van-nav-bar")+e.resolveComponent("van-field")+e.resolveComponent("van-card")+e.resolveComponent("van-button"))()}const t={__name:"pay",setup(t){const l=e.index.getStorageSync("sessionCookie");o.Store();const r=e.ref({}),n=e.ref(!0);e.onLoad((async e=>{"goodsStore"in e&&(r.value=JSON.parse(decodeURIComponent(e.goodsStore)),console.log(r.value)),"orderDetail"in e&&(r.value=JSON.parse(decodeURIComponent(e.orderDetail)),console.log(r.value),n.value=!1),console.log(n.value),d()}));const u=e.ref([]),d=async()=>{await a.request({url:"userCart/my/list/page/vo",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{cartId:r.value.cartId,current:1,id:0,isDelete:0,num:0,pageSize:10,schoolId:r.value.schoolId,schoolStoreFeedId:0,sortField:"",sortOrder:"",state:r.value.state||0,sum_money:0,userId:0}}).then((e=>{u.value=e.data.data||null,console.log("购物车列表",u.value)}))},s=e.computed((()=>{let e=0;for(let o of u.value)e+=o.num*o.feeds.new_money+2;return e})),c=async(e,o)=>{console.log(o),await u.value.forEach((t=>{t.schoolStoreFeedId===o.schoolStoreFeedId&&t.num+e>0&&(t.num+=e,a.request({url:"userCart/update/by/Cart/Id",method:"POST",data:{cartId:r.value.cartId,num:t.num,schoolId:r.value.schoolId,schoolStoreFeedId:parseInt(t.schoolStoreFeedId),sum_money:t.num*o.feeds.new_money,userId:0},header:{"content-type":"application/json",Cookie:l}}).then((e=>{console.log("修改购物车商品消息",e.data),d()})))}))},v=e.ref(""),i=e=>{v.value=e.detail.value.trim(),0==v.value.length&&(m.value=!0,setTimeout((()=>{m.value=!1}),500))},m=e.ref(!1),p=e.ref(""),f=e=>{p.value=e.detail.trim()},h=async()=>{v.value.length>0?await a.request({url:"userCart/update/state/by/CartIdAndUserId",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{cartId:r.value.cartId,state:1,address:v.value,content:p.value}}).then((o=>{console.log("订单状态",o),0===o.data.code&&(e.index.removeStorageSync(r.value.schoolId.toString()),e.index.removeStorageSync(r.value.storeName),setTimeout((()=>{e.index.switchTab({url:"/pages/index/index"})}),1500))})):(m.value=!0,await setTimeout((()=>{m.value=!1}),500))},g=()=>{e.index.navigateBack()};return(o,a)=>e.e({a:e.o(g),b:e.p({leftText:"返回",leftArrow:!0,safeAreaInsetTop:!1}),c:e.o(i),d:e.p({value:u.value[0].address,placeholder:"请输入校内送货地址",required:!0,readonly:!n.value,autoFocus:!0}),e:e.t(r.value.storeName),f:e.t(r.value.cartId),g:e.f(u.value,((o,a,t)=>e.e(n.value?{a:e.o((e=>c(-1,o)),a),b:e.t(o.num),c:e.o((e=>c(1,o)),a)}:{d:e.t(o.num)},{e:a,f:"bec7ffca-2-"+t,g:e.p({price:o.sum_money,title:o.feeds.feed_name,thumb:o.feeds.url})}))),h:n.value,i:e.o(f),j:e.p({label:"备注:",type:"textarea",value:u.value[0].content,placeholder:"请输入50字以内备注",autosize:!0,readonly:!n.value,maxlength:50}),k:e.p({label:"跑腿酬金:",type:"text",value:"2元",readonly:!0}),l:n.value},n.value?{m:e.t(e.unref(s)),n:e.o(h),o:e.p({round:!0,type:"info",color:"linear-gradient(to right, #ff5500, #ff0000)"})}:{},{p:m.value})}};wx.createPage(t);
