"use strict";const e=require("../../common/vendor.js"),t=require("../../request/index.js"),a=require("../../stores/counter.js");if(!Array){(e.resolveComponent("van-sidebar-item")+e.resolveComponent("van-sidebar")+e.resolveComponent("van-card")+e.resolveComponent("van-tab")+e.resolveComponent("van-button")+e.resolveComponent("van-empty")+e.resolveComponent("van-tabs")+e.resolveComponent("van-overlay")+e.resolveComponent("van-loading"))()}const o={__name:"order",setup(o){const r=a.Store(),l=e.index.getStorageSync("sessionCookie");let n=["创建接单","暂无接单","派送中","已完成"],d=["暂无接单","派送中","已完成"];const s=e.ref(!1),u=()=>{s.value=!1};let i=null,c=null,p=null;const v=()=>{i?(m(i),i=null):(y(c,p),c=null,p=null)},m=async e=>{s.value=!1,await t.request({url:"userCart/update/state/by/CartIdAndUserId",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{cartId:e,state:3}}).then((e=>{console.log(e),0===e.data.code&&(P.value=[],S=1,x=!0,F())}))},y=async(e,a)=>{console.log(e,a),s.value=!1,await t.request({url:"holdOrder/update/success",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{id:e,submit_id:a}}).then((e=>{0===e.data.code&&(R.value=[],C=1,L=!0,A())}))};e.onLoad((()=>{N()}));let h=0;const g=e=>{h=e.detail.index,0==h?(_.value=0,w.value=[],O=1,b=1,I=!0,z=!0,N()):1==h&&(J.value=0,P.value=[],S=1,C=1,x=!0,L=!0,F())},f=e.ref(!1);e.onPullDownRefresh((()=>{I=!0,z=!0,x=!0,L=!0}));let O=1,b=1,S=1,C=1;e.onReachBottom((async()=>{f.value=!0,await setTimeout((()=>{f.value=!1,0==h&&0==_.value?(console.log("发布外卖订单"),O++,N()):0==h&&1==_.value?(console.log("发布其他订单"),b++,q()):1==h&&0==J.value?(console.log("服务外卖订单"),S++,F()):1==h&&1==J.value&&(console.log("服务其他订单"),C++,A())}),800)}));let I=!0;const T=e.ref(!0),_=e.ref(0),w=e.ref([]),N=async()=>{T.value=!0,_.value=0,I&&await t.request({url:"userCart/my/list/page/vo",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{cartId:0,current:O,id:0,isDelete:0,num:0,pageSize:10,schoolId:1,schoolStoreFeedId:0,sortField:"createTime",sortOrder:"ascend",state:4,sum_money:0,user_id:r.userId}}).then((e=>{0==e.data.data.length?I=!1:(console.log("发布外卖订单:",e.data.data),w.value.push(...e.data.data))}))};let z=!0;const j=e.ref([]),q=async()=>{T.value=!1,_.value=1,z&&await t.request({url:"submitOrder/my/list/page/vo",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{current:b,id:"",isDelete:0,order_state:4,pageSize:10,schoolId:0,sortField:"",sortOrder:"",submit_index:0,userId:r.userId}}).then((e=>{0==e.data.data.records.length?z=!1:(j.value.push(...e.data.data.records),console.log("发布其他订单",e.data.data.records))}))};let x=!0;const k=e.ref(!0),J=e.ref(0),P=e.ref([]),D=e.ref(!1),F=async()=>{k.value=!0,J.value=0,x&&await t.request({url:"feedOrderCenter/my/holdOrder/list",method:"POST",data:{current:S,pageSize:10,id:0,mpOpenId:"",sortField:"",sortOrder:"",unionId:"",userMoney:0,userName:"",userProfile:"",userRole:""},header:{"content-type":"application/json",Cookie:l}}).then((e=>{console.log(e),null==e.data.data?x=!1:P.value.push(...e.data.data),null==P.value&&(D.value=!0),console.log("服务外卖订单",P.value)}))};let L=!0;const R=e.ref([]),A=async()=>{k.value=!1,J.value=1,L&&await t.request({url:"holdOrder/my/hold/list",method:"POST",header:{"content-type":"application/json",Cookie:l},data:{current:C,pageSize:10}}).then((e=>{null==e.data.data?L=!1:(R.value.push(...e.data.data),console.log("服务其他订单",R.value))}))},M=e=>{let t=new Date(e);return(parseInt(t.getMonth())+1).toString()+"月"+t.getDate()+"日"+t.getHours()+"时"+t.getMinutes()+"分"};return(t,a)=>({a:e.o(N),b:e.p({title:"外卖订单",dot:!0}),c:e.o(q),d:e.p({title:"其他订单",dot:!0}),e:e.p({activeKey:_.value}),f:e.f(w.value,((t,a,o)=>({a:e.t(M(t.createTime)),b:e.t(M(t.deliveryTime)),c:"6ec1d76d-5-"+o+",6ec1d76d-1",d:e.p({price:t.sum_money,title:t.feeds.feed_name,thumb:t.feeds.url,tag:e.unref(n)[t.state],lazyLoad:!0}),e:a}))),g:T.value,h:e.f(j.value,((t,a,o)=>({a:e.t(JSON.parse(t.content).explain.replace(/null/g,"")),b:e.t(M(JSON.parse(t.content).expectTime)),c:"6ec1d76d-6-"+o+",6ec1d76d-1",d:e.p({title:JSON.parse(t.content).className,price:JSON.parse(t.content).order_money,lazyLoad:!0}),e:e.t(e.unref(d)[t.order_state]),f:a}))),i:!T.value,j:e.p({title:"发布订单"}),k:e.o(F),l:e.p({title:"外卖订单",dot:!0}),m:e.o(A),n:e.p({title:"其他订单",dot:!0}),o:e.p({activeKey:J.value}),p:e.f(P.value,((t,a,o)=>e.e({a:e.t(M(t.createTime)),b:e.t(M(t.deliveryTime)),c:"6ec1d76d-11-"+o+",6ec1d76d-7",d:e.p({title:t.storeName,thumb:t.schoolStoreFeeds.url,tag:e.unref(n)[t.state],lazyLoad:!0}),e:e.o((a=>((t,a)=>{if(2==a){let o={cartId:t,state:a};e.index.navigateTo({url:`/subpages/pay/pay?orderDetail=${encodeURIComponent(JSON.stringify(o))}`})}})(t.cartId,t.state)),a),f:3==t.state},3==t.state?{}:{g:e.o((e=>{return a=t.cartId,s.value=!0,void(i=a);var a}),a),h:"6ec1d76d-12-"+o+",6ec1d76d-7",i:e.p({type:"primary",size:"small"})},{j:a}))),q:D.value,r:e.p({description:"暂无服务外卖订单"}),s:k.value,t:e.f(R.value,((t,a,o)=>e.e({a:e.t(JSON.parse(t.submitOrder.content).explain.replace(/null/g,"")),b:e.t(M(JSON.parse(t.submitOrder.content).expectTime)),c:"6ec1d76d-14-"+o+",6ec1d76d-7",d:e.p({title:JSON.parse(t.submitOrder.content).className,price:JSON.parse(t.submitOrder.content).order_money,lazyLoad:!0}),e:2==t.submitOrder.order_state},2==t.submitOrder.order_state?{}:{f:e.o((e=>{return a=t.id,o=t.submit_id,s.value=!0,c=a,void(p=o);var a,o}),a),g:"6ec1d76d-15-"+o+",6ec1d76d-7",h:e.p({type:"primary",size:"small"})},{i:a}))),v:!k.value,w:e.p({title:"服务订单"}),x:e.o(g),y:e.p({animated:!0,swipeable:!0,sticky:!0}),z:e.o(v),A:e.p({type:"primary",size:"large",round:!0,color:"linear-gradient(to right, #ff2950, #f64a06)"}),B:e.o(u),C:e.p({show:s.value}),D:e.p({color:"#1989fa",type:"spinner"}),E:f.value})}};wx.createPage(o);
