"use strict";const e=require("../../common/vendor.js"),t=require("../../request/index.js");if(!Array){(e.resolveComponent("van-button")+e.resolveComponent("van-card")+e.resolveComponent("van-loading")+e.resolveComponent("van-tab")+e.resolveComponent("van-tabs"))()}const a={__name:"list",setup(a){const r=e.index.getStorageSync("sessionCookie");let o=!0;e.onPullDownRefresh((()=>{o=!0,0==d?(p.value=[],c(1)):1==d&&(v.value=[],m(1))})),e.onTabItemTap((e=>{o=!0,p.value=[],c(1)}));let n=1,s=1;const i=e.ref(!1);e.onReachBottom((()=>{0==d?(n++,c(n)):1==d&&(s++,m(s))}));let d=0;const l=e=>{console.log(e.detail.index),d=e.detail.index,o=!0,0==d?(p.value=[],c(1)):1==d&&(v.value=[],m(1))},u=e.ref(!1),p=e.ref([]),c=async e=>{o&&await t.request({url:"feedOrderCenter/list/page",method:"POST",data:{cart_id:0,current:e,id:0,isDelete:0,pageSize:10,running_user_id:0,sortField:"",sortOrder:"",state:0,user_id:0}}).then((e=>{console.log("订单",e.data),0==e.data.data.records.length?o=!1:(i.value=!0,setTimeout((()=>{i.value=!1,p.value.push(...e.data.data.records)}),1e3))}))},v=e.ref([]),m=async e=>{o&&t.request({url:"submitOrder/my/list/page/vo",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{current:e,id:"",isDelete:0,order_state:0,pageSize:10,schoolId:0,sortField:"",sortOrder:"",submit_index:0,userId:0}}).then((e=>{console.log("其他订单",e.data),0==e.data.data.records.length?o=!1:(i.value=!0,setTimeout((()=>{i.value=!1,v.value.push(...e.data.data.records)}),1e3))}))},g=e=>{let t=new Date(e);return(parseInt(t.getMonth())+1).toString()+"月"+t.getDate()+"日"+t.getHours()+"时"+t.getMinutes()+"分"};return(a,n)=>({a:e.f(p.value,((a,n,s)=>({a:e.t(g(a.createTime)),b:e.t(g(a.delivery_time)),c:e.o((t=>((t,a)=>{let r={cartId:t,state:a};e.index.navigateTo({url:`/subpages/pay/pay?orderDetail=${encodeURIComponent(JSON.stringify(r))}`})})(a.cart_id,a.state+1)),n),d:e.o((e=>(async e=>{await t.request({url:"feedOrderCenter/update",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{cart_id:e,id:0,running_user_id:0}}).then((e=>{0==e.data.code&&(u.value=!0,o=!0,p.value=[],c(1),setTimeout((()=>{u.value=!1}),500))}))})(a.cart_id)),n),e:"582b3a8f-3-"+s+",582b3a8f-2-"+s,f:"582b3a8f-2-"+s+",582b3a8f-1",g:e.p({price:a.money,title:a.delivery_address,thumb:a.user_head_img,lazyLoad:!0}),h:n}))),b:e.p({type:"primary"}),c:e.p({color:"#1989fa",type:"spinner"}),d:i.value,e:e.p({title:"外卖订单"}),f:e.f(v.value,((a,n,s)=>({a:e.t(JSON.parse(a.content).explain.replace(/null/g,"")),b:e.t(g(JSON.parse(a.content).expectTime)),c:e.o((e=>(async e=>{await t.request({url:"submitOrder/update/togoQiang",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{id:e,isDelete:0,order_state:1}}).then((e=>{0==e.data.code&&(u.value=!0,o=!0,v.value=[],m(1),setTimeout((()=>{u.value=!1}),500))}))})(a.id)),n),d:"582b3a8f-7-"+s+",582b3a8f-6-"+s,e:"582b3a8f-6-"+s+",582b3a8f-5",f:e.p({title:JSON.parse(a.content).className,price:JSON.parse(a.content).order_money,lazyLoad:!0}),g:n}))),g:e.p({type:"primary"}),h:e.p({color:"#1989fa",type:"spinner"}),i:i.value,j:e.p({title:"其他订单"}),k:e.o(l),l:e.p({animated:!0,swipeable:!0,sticky:!0}),m:u.value})}};wx.createPage(a);
